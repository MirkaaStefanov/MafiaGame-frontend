<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="UTF-8">
    <title>Lobby</title>
    <script>
    const gameId = [[${gameId}]]; // Thymeleaf will render the game ID here


    const token = [[${token}]];  // Replace with actual token retrieval logic

    const url = `/game/players?gameId=${gameId}`;

    function fetchPlayers() {
    fetch(url, {
    method: 'GET',
    headers: {
    'Authorization': `Bearer ${token}`
    'Content-Type': 'application/json'
    }
    })
    .then(response => response.json())
    .then(players => updatePlayerList(players));
    }

    function updatePlayerList(players) {
    const playerListContainer = document.getElementById('player-list');
    playerListContainer.innerHTML = ''; // Clear the existing list

    players.forEach(player => {
    const listItem = document.createElement('li');
    listItem.textContent = player.username; // Adjust this based on your User model
    playerListContainer.appendChild(listItem);
    });
    }

    // Poll the server every 5 seconds to get the latest player data
    setInterval(fetchPlayers, 5000);

    // Initial fetch
    fetchPlayers();
    </script>
</head>
<body>
<h1 th:text="${gameId}"></h1>
<form th:action="@{/game/start}" method="post">
    <label for="gameId">Game ID:</label>
    <input type="hidden" id="gameId" th:value="${gameId}" name="gameId" required>

    <label for="killerQuantity">Killer Quantity:</label>
    <input type="number" id="killerQuantity" name="killerQuantity" required>

    <label for="doctorQuantity">Doctor Quantity:</label>
    <input type="number" id="doctorQuantity" name="doctorQuantity" required>

    <label for="policeQuantity">Police Quantity:</label>
    <input type="number" id="policeQuantity" name="policeQuantity" required>

    <button type="submit">Start Game</button>
</form>

<h3>Players in the Game:</h3>
<ul id="player-list">
    <!-- Loop through allMafiaPlayers and display each player -->
    <li th:each="player : ${allMafiaPlayers}" class="player-item"
        th:classappend="${player.role == 'NARRATOR' ? ' narrator' : ''} "
        th:text="${player.user.username}">
    </li>
</ul>
</body>
</html>